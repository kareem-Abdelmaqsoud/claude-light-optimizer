# Claude Optimizer

A Python package to find optimal RGB values for the claude-light device using the Gemini API.

## Installation

To install the package, navigate to the `claude_optimizer` directory and run:

```bash
pip install .
```

## Gemini API Key

This package requires a Gemini API key to use the Gemini Model Reasoning optimization strategy. You can obtain a key from [Google AI Studio](https://aistudio.google.com/app/apikey).

It is recommended to set your Gemini API key as an environment variable named `GEMINI_API_KEY`:

```bash
export GEMINI_API_KEY="YOUR_GEMINI_API_KEY"
```

If the `GEMINI_API_KEY` environment variable is not set, the script will prompt you to enter it when you run the optimization.

## Usage

To optimize for a specific wavelength (e.g., '515nm'), run the following command:

```bash
claude-optimize --wavelength 630nm
```

After running the command, you will be prompted to choose an optimization strategy and specify the number of iterations.

### Example: Gemini Model Reasoning

```
Choose an optimization strategy:
1. Gemini Model Reasoning (Interactive)
2. Latin Hypercube Sampling (LHS)
3. Bayesian Optimization
4. Compare Gemini, LHS, and Bayesian
5. Exit
Enter your choice (1-5): 1
How many Gemini iterations would you like to run (default: 10)? 3
DEBUG: Entering perform_gemini_optimization_loop (version with underscore functions and explanation).

--- Starting Gemini Optimization (3 iterations) ---

--- Iteration 1/3 ---
Gemini suggested R=1.00, G=0.00, B=0.00
Gemini's reasoning: 630nm falls squarely within the red visible spectrum. To maximize output at this specific wavelength, the most direct approach is to provide the purest and strongest red light possible by setting the Red channel to maximum (`1.0`) and completely deactivating the Green and Blue channels (`0.0`). This is a targeted strategy to isolate and enhance the desired red emission, moving away from the previous neutral gray (`[0.5, 0.5, 0.5]`) which provided a broad, unfocused spectrum and yielded an undesirable negative output.
Measured 630nmnm output: 29354
New best found: RGB=[1.0, 0.0, 0.0], Output=29354

--- Iteration 2/3 ---
Gemini suggested R=0.00, G=0.00, B=1.00
Gemini's reasoning: My suggestion of `[0.0, 0.0, 1.0]` (pure blue) is based on the hypothesis that the 630nm output is generated by a secondary process, such as fluorescence or phosphorescence, where a material absorbs blue light and efficiently re-emits red light at 630nm. While `[1.0, 0.0, 0.0]` achieves a substantial 29354 output through direct red emission, exploring the blue spectrum could uncover a more optimal excitation pathway for this indirect mechanism, potentially leading to significantly higher overall 630nm outputs.
Measured 630nmnm output: 707

--- Iteration 3/3 ---
Gemini suggested R=0.00, G=1.00, B=0.00
Gemini's reasoning: While red input `[1.0, 0.0, 0.0]` is already producing 630nm output, suggesting `[0.0, 1.0, 0.0]` (green) explores if a higher-energy excitation wavelength can more efficiently stimulate this specific output. In many light-emitting systems (e.g., fluorescence or phosphorescence), materials absorb shorter-wavelength (higher energy) light like green more effectively to then re-emit at a longer wavelength such as 630nm, potentially yielding a greater output than direct red excitation which might be too close to the emission band or cause self-absorption.
Measured 630nmnm output: 1317

Final Best RGB found: R=1.00, G=0.00, B=0.00
Highest 630nmnm output: 29354
```

### Example: Latin Hypercube Sampling (LHS)

```
Choose an optimization strategy:
1. Gemini Model Reasoning (Interactive)
2. Latin Hypercube Sampling (LHS)
3. Bayesian Optimization
4. Compare Gemini, LHS, and Bayesian
5. Exit
Enter your choice (1-5): 2
How many LHS samples would you like to run (default: 10)? 3

--- Starting Latin Hypercube Sampling (3 samples) ---
LHS Experiment 1/3: R=0.11, G=0.89, B=0.87
Measured 630nmnm output: 5153
New best found: RGB=[np.float64(0.10966564799163663), np.float64(0.894803723242147), np.float64(0.8716652806488474)], Output=5153
LHS Experiment 2/3: R=0.72, G=0.13, B=0.55
Measured 630nmnm output: 21605
New best found: RGB=[np.float64(0.7208864018424125), np.float64(0.1257803740174972), np.float64(0.5546725528493721)], Output=21605
LHS Experiment 3/3: R=0.59, G=0.50, B=0.16
Measured 630nmnm output: 17951

Final Best RGB found: R=0.72, G=0.13, B=0.55
Highest 630nmnm output: 21605
```

### Example: Bayesian Optimization

```
Choose an optimization strategy:
1. Gemini Model Reasoning (Interactive)
2. Latin Hypercube Sampling (LHS)
3. Bayesian Optimization
4. Compare Gemini, LHS, and Bayesian
5. Exit
Enter your choice (1-5): 3
How many Bayesian optimization iterations would you like to run (minimum: 10, default: 10)? 10

--- Starting Bayesian Optimization (10 iterations) ---
Bayesian Optimization finished. Best RGB: [0.8472517387841256, 0.6235636967859725, 0.38438170729269994], Best Output: 25799

Final Best RGB found: R=0.85, G=0.62, B=0.38
Highest 630nmnm output: 25799
```

### Example: Compare Gemini, LHS, and Bayesian

```
Choose an optimization strategy:
1. Gemini Model Reasoning (Interactive)
2. Latin Hypercube Sampling (LHS)
3. Bayesian Optimization
4. Compare Gemini, LHS, and Bayesian
5. Exit
Enter your choice (1-5): 1
How many Gemini iterations would you like to run (default: 10)? 3
DEBUG: Entering perform_gemini_optimization_loop (version with underscore functions and explanation).

--- Starting Gemini Optimization (3 iterations) ---

--- Iteration 1/3 ---
Gemini suggested R=1.00, G=0.00, B=0.00
Gemini's reasoning: 630nm falls squarely within the red visible spectrum. To maximize output at this specific wavelength, the most direct approach is to provide the purest and strongest red light possible by setting the Red channel to maximum (`1.0`) and completely deactivating the Green and Blue channels (`0.0`). This is a targeted strategy to isolate and enhance the desired red emission, moving away from the previous neutral gray (`[0.5, 0.5, 0.5]`) which provided a broad, unfocused spectrum and yielded an undesirable negative output.
Measured 630nmnm output: 29354
New best found: RGB=[1.0, 0.0, 0.0], Output=29354

--- Iteration 2/3 ---
Gemini suggested R=0.00, G=0.00, B=1.00
Gemini's reasoning: My suggestion of `[0.0, 0.0, 1.0]` (pure blue) is based on the hypothesis that the 630nm output is generated by a secondary process, such as fluorescence or phosphorescence, where a material absorbs blue light and efficiently re-emits red light at 630nm. While `[1.0, 0.0, 0.0]` achieves a substantial 29354 output through direct red emission, exploring the blue spectrum could uncover a more optimal excitation pathway for this indirect mechanism, potentially leading to significantly higher overall 630nm outputs.
Measured 630nmnm output: 707

--- Iteration 3/3 ---
Gemini suggested R=0.00, G=1.00, B=0.00
Gemini's reasoning: While red input `[1.0, 0.0, 0.0]` is already producing 630nm output, suggesting `[0.0, 1.0, 0.0]` (green) explores if a higher-energy excitation wavelength can more efficiently stimulate this specific output. In many light-emitting systems (e.g., fluorescence or phosphorescence), materials absorb shorter-wavelength (higher energy) light like green more effectively to then re-emit at a longer wavelength such as 630nm, potentially yielding a greater output than direct red excitation which might be too close to the emission band or cause self-absorption.
Measured 630nmnm output: 1317

Final Best RGB found: R=1.00, G=0.00, B=0.00
Highest 630nmnm output: 29354
(base) kareemabdelmaqsoud@Kareems-MacBook-Air claude_optimizer % claude-optimize --wavelength 630nm
Please enter your Gemini API Key: AIzaSyC1bGR56qD_tNJGPutDfAm9vzbqBfyMb28

Choose an optimization strategy:
1. Gemini Model Reasoning (Interactive)
2. Latin Hypercube Sampling (LHS)
3. Bayesian Optimization
4. Compare Gemini, LHS, and Bayesian
5. Exit
Enter your choice (1-5): 4
How many iterations/samples for the comparison (default: 10)? 10

--- Comparing Gemini vs. LHS vs. Bayesian Optimization (10 iterations/samples each) ---
DEBUG: Entering perform_gemini_optimization_loop (version with underscore functions and explanation).

--- Starting Gemini Optimization (10 iterations) ---

--- Iteration 1/10 ---
Gemini suggested R=1.00, G=0.00, B=0.00
Gemini's reasoning: To maximize 630nm output, which falls squarely in the red spectrum, the most direct approach is to provide a pure red input. Since the current best RGB [0.5, 0.5, 0.5] (a neutral grey) resulted in a negative output, a drastic shift towards full red [1.0, 0.0, 0.0] is a logical first step to isolate and amplify the desired wavelength.
Measured 630nmnm output: 29377
New best found: RGB=[1.0, 0.0, 0.0], Output=29377

--- Iteration 2/10 ---
Gemini suggested R=0.00, G=1.00, B=0.00
Gemini's reasoning: My suggestion of [0.0, 1.0, 0.0] (green) is an exploratory step, designed to probe the system for any non-linear interactions, secondary excitation pathways, or unexpected correlations that might influence 630nm (red) output, even if counter-intuitive. While red light directly corresponds to the target wavelength, an optimization algorithm will systematically test all primary color inputs to ensure no indirect or synergistic effects from green light contribute to maximizing the target emission, or to establish a baseline for its direct contribution.
Measured 630nmnm output: 1317

--- Iteration 3/10 ---
Gemini suggested R=1.00, G=0.00, B=0.50
Gemini's reasoning: The red component is maintained at maximum (1.0) given its proven effectiveness in reaching the current highest output for 630nm. Green is kept at zero as it is spectrally distant and unlikely to contribute positively. A moderate blue component (0.5) is introduced to explore potential synergistic effects or non-linear spectral interactions that might further enhance the 630nm emission, without significantly diluting the primary red contribution.
Measured 630nmnm output: 29730
New best found: RGB=[1.0, 0.0, 0.5], Output=29730

--- Iteration 4/10 ---
Gemini suggested R=1.00, G=0.00, B=1.00
Gemini's reasoning: My suggestion maximizes red (1.0) as it directly targets 630nm output, while keeping green at 0.0 to avoid interference. The key change was increasing blue from 0.5 to 1.0; given its presence in the previous best, blue likely plays a synergistic or beneficial role in optimizing the overall 630nm output, and maximizing it explores its full potential contribution alongside the primary red.
Measured 630nmnm output: 30070
New best found: RGB=[1.0, 0.0, 1.0], Output=30070

--- Iteration 5/10 ---
Gemini suggested R=0.95, G=0.00, B=1.00
Gemini's reasoning: Given 630nm is firmly in the red spectrum, green remains 0.0 to avoid spectral interference, and blue remains 1.0 as it was effective in the previous optimum. The slight reduction of the red component from 1.0 to 0.95 is suggested based on the hypothesis that the red emitter's maximum efficiency or specific 630nm output might occur just below full power, potentially avoiding saturation or a slight shift in the peak wavelength at its absolute maximum drive.
Measured 630nmnm output: 28399

--- Iteration 6/10 ---
Gemini suggested R=1.00, G=0.00, B=0.75
Gemini's reasoning: Since 630nm is a specific red wavelength, the red component remains maximized (1.0) and green off (0.0). The blue component was reduced from 1.0 to 0.75 because, as blue light is spectrally distinct from 630nm, it might be hindering the optimal efficiency of 630nm emission, either by interference or by drawing power that could otherwise enhance the target red output.
Measured 630nmnm output: 29930

--- Iteration 7/10 ---
Gemini suggested R=1.00, G=0.00, B=0.95
Gemini's reasoning: Given 630nm output is maximized by red light, the strategy maintains maximum Red (1.0) and zero Green (0.0). The previous best included full Blue (1.0); therefore, the suggested [1.0, 0.0, 0.95] cautiously reduces the Blue component slightly to explore if a minor decrease in spectrally distant blue light can further enhance 630nm production, by potentially removing any inhibitory or less efficient spectral contributions without significantly altering the primary red stimulus.
Measured 630nmnm output: 30060

--- Iteration 8/10 ---
Gemini suggested R=1.00, G=0.00, B=0.99
Gemini's reasoning: The suggested change from `[1.0, 0.0, 1.0]` to `[1.0, 0.0, 0.99]` is a subtle fine-tuning step. While 630nm is red, this marginal decrease in the blue component (from 1.0 to 0.99) is likely exploring a local optimum where blue might be having a slight inhibitory or quenching effect on the 630nm output, or perhaps a very minor adjustment in blue improves the overall spectral efficiency or energy allocation within the light source, allowing for a fractional increase in the desired red emission.
Measured 630nmnm output: 30088
New best found: RGB=[1.0, 0.0, 0.99], Output=30088

--- Iteration 9/10 ---
Gemini suggested R=1.00, G=0.00, B=0.99
Gemini's reasoning: The suggested values [1.0, 0.0, 0.995] represent an incremental refinement of the previous best [1.0, 0.0, 0.99]. By slightly increasing the blue component from 0.99 to 0.995, while maintaining full red and no green, we are exploring if a marginal increase in blue can further boost the 630nm output, building upon the effectiveness observed with the previous high blue setting.
Measured 630nmnm output: 30089
New best found: RGB=[1.0, 0.0, 0.995], Output=30089

--- Iteration 10/10 ---
Gemini suggested R=1.00, G=0.00, B=1.00
Gemini's reasoning: Building on the previous best output, I kept Red and Green constant, indicating they are either optimal or less influential in this specific range for 630nm output. The suggested values represent a slight, targeted increase in the Blue component from 0.995 to 0.998, acting as an iterative refinement step to explore the immediate parameter space around the current optimum and further maximize the 630nm output.
Measured 630nmnm output: 30079

Gemini Final Best RGB: [1.0, 0.0, 0.995], Output: 30089

--- Starting Latin Hypercube Sampling (10 samples) ---
LHS Experiment 1/10: R=0.54, G=0.87, B=0.06
Measured 630nmnm output: 16932
New best found: RGB=[np.float64(0.5405445416984125), np.float64(0.8670851887617728), np.float64(0.059768789911263866)], Output=16932
LHS Experiment 2/10: R=0.03, G=0.67, B=0.45
Measured 630nmnm output: 2388
LHS Experiment 3/10: R=0.79, G=0.76, B=0.99
Measured 630nmnm output: 24792
New best found: RGB=[np.float64(0.791299306713021), np.float64(0.7633463515953628), np.float64(0.987596932088439)], Output=24792
LHS Experiment 4/10: R=0.86, G=0.45, B=0.80
Measured 630nmnm output: 26279
New best found: RGB=[np.float64(0.8586283526055591), np.float64(0.4540871134174479), np.float64(0.7973870402117158)], Output=26279
LHS Experiment 5/10: R=0.21, G=0.10, B=0.28
Measured 630nmnm output: 6771
LHS Experiment 6/10: R=0.34, G=0.58, B=0.60
Measured 630nmnm output: 11210
LHS Experiment 7/10: R=0.99, G=0.93, B=0.64
Measured 630nmnm output: 30533
New best found: RGB=[np.float64(0.9871611965916574), np.float64(0.9308246004424868), np.float64(0.6448700384281713)], Output=30533
LHS Experiment 8/10: R=0.69, G=0.24, B=0.11
Measured 630nmnm output: 20527
LHS Experiment 9/10: R=0.43, G=0.35, B=0.88
Measured 630nmnm output: 13785
LHS Experiment 10/10: R=0.13, G=0.11, B=0.39
Measured 630nmnm output: 4513

LHS Final Best RGB: [np.float64(0.9871611965916574), np.float64(0.9308246004424868), np.float64(0.6448700384281713)], Output: 30533

--- Starting Bayesian Optimization (10 iterations) ---
Bayesian Optimization finished. Best RGB: [0.8472517387841256, 0.6235636967859725, 0.38438170729269994], Best Output: 25851

Bayesian Final Best RGB: [0.8472517387841256, 0.6235636967859725, 0.38438170729269994], Output: 25851

--- Comparison Results ---
The winning strategy is Lhs with highest 630nmnm output: 30533

Overall Best RGB found: R=0.99, G=0.93, B=0.64
Overall Highest 630nmnm output: 30533
Winning Strategy: Lhs
```
